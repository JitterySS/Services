# MADE BY CHATGPT
# Script to check status, startup type, and start time of specific Windows services

# List of services to check
$services = @(
    "SysMain",
    "CDPUserSvc",
    "PcaSvc",
    "DPS",
    "EventLog",
    "Schedule",    # Task Scheduler
    "WSearch",     # SearchIndexer
    "Bam",
    "Dam",
    "DusmSvc",
    "Appinfo"
)

# Output file in Downloads
$downloads = [Environment]::GetFolderPath("UserProfile") + "\Downloads\services.txt"

# Collect results
$results = foreach ($svc in $services) {
    # Get all matching services (handles dynamic names like CDPUserSvc_*)
    $matchedServices = Get-Service | Where-Object { $_.Name -like "$svc*" }
    if ($matchedServices) {
        foreach ($service in $matchedServices) {
            # Get startup type
            $config = Get-WmiObject Win32_Service -Filter "Name='$($service.Name)'" | Select-Object -ExpandProperty StartMode

            # Get start time safely
            try {
                $startTime = (Get-Process -Id $service.Id -ErrorAction Stop).StartTime.ToString("yyyy-MM-dd HH:mm:ss")
            } catch {
                $startTime = "N/A"
            }

            # Output object
            [PSCustomObject]@{
                Service     = $service.Name
                DisplayName = $service.DisplayName
                Status      = $service.Status
                StartupType = $config
                StartedAt   = $startTime
            }
        }
    } else {
        # If no service found
        [PSCustomObject]@{
            Service     = $svc
            DisplayName = "Not Found"
            Status      = "N/A"
            StartupType = "N/A"
            StartedAt   = "N/A"
        }
    }
}

# Write results to file
$results | Format-Table -AutoSize | Out-String | Set-Content -Path $downloads

# Open in Notepad
Start-Process notepad.exe $downloads

# Close current PowerShell window
Stop-Process -Id $PID
