# List of services to check
$services = @(
    "SysMain",
    "CDPUserSvc_*",
    "PcaSvc",
    "DPS",
    "EventLog",
    "Schedule",
    "WSearch",      # SearchIndexer
    "BAM",          # BAM/DAM
    "DUSMsvc",
    "Appinfo"
)

function Get-ServiceDetails {
    param ($serviceName)

    # Get the service objects, supporting wildcards
    $serviceObjects = Get-CimInstance Win32_Service -Filter "Name LIKE '$serviceName'" -ErrorAction SilentlyContinue
    if (!$serviceObjects) { return @() }

    $results = @()
    foreach ($svc in $serviceObjects) {
        # Determine start time
        if ($svc.State -eq "Running") {
            try {
                $proc = Get-Process -Id $svc.ProcessId -ErrorAction SilentlyContinue
                $startTime = if ($proc) { $proc.StartTime } else { "Unknown" }
            } catch {
                $startTime = "Unknown"
            }
        } else {
            $startTime = "Not running"
        }

        $results += [PSCustomObject]@{
            ServiceName  = $svc.Name
            DisplayName  = $svc.DisplayName
            Status       = $svc.State
            StartType    = $svc.StartMode
            ProcessID    = $svc.ProcessId
            StartTime    = $startTime
            Executable   = $svc.PathName
        }
    }
    return $results
}

function Show-Dashboard {
    Write-Host "`n--- Services Dashboard ---`n"

    foreach ($svcName in $services) {
        $svcInfos = Get-ServiceDetails $svcName
        if (!$svcInfos) {
            Write-Host "$svcName : Not Found"
            continue
        }
        foreach ($svc in $svcInfos) {
            Write-Host "----------------------------------------"
            Write-Host "Service Name : $($svc.ServiceName)"
            Write-Host "Display Name : $($svc.DisplayName)"
            Write-Host "Status       : $($svc.Status)"
            Write-Host "Start Type   : $($svc.StartType)"
            Write-Host "Process ID   : $($svc.ProcessID)"
            Write-Host "Start Time   : $($svc.StartTime)"
            Write-Host "Executable   : $($svc.Executable)"
        }
    }

    Write-Host "`nPress Enter to close..."
    Read-Host
}

# Run the dashboard
Show-Dashboard
