# Service list
$services = @{
    1 = "SysMain"
    2 = "CDPUserSvc_*"
    3 = "PcaSvc"
    4 = "DPS"
    5 = "EventLog"
    6 = "Schedule"
    7 = "WSearch"         # SearchIndexer
    8 = "BAM"             # BAM/DAM
    9 = "DUSMsvc"         # Dusmsvc
    10 = "Appinfo"
}

function Get-ServiceInfo {
    param ($serviceName, $detailed=$false)
    
    $serviceObjects = Get-CimInstance Win32_Service -Filter "Name LIKE '$serviceName'" -ErrorAction SilentlyContinue
    if (!$serviceObjects) {
        Write-Host "$serviceName : Not Found"
        return
    }

    foreach ($svc in $serviceObjects) {
        $status = $svc.State
        if ($status -eq "Running") {
            try {
                $proc = Get-Process -Id $svc.ProcessId -ErrorAction SilentlyContinue
                $startTime = if ($proc) { $proc.StartTime } else { "Unknown" }
            } catch {
                $startTime = "Unknown"
            }
        } else {
            $startTime = "Not running"
        }

        if ($detailed) {
            Write-Host "----------------------------------------"
            Write-Host "Service Name     : $($svc.Name)"
            Write-Host "Display Name     : $($svc.DisplayName)"
            Write-Host "Status           : $status"
            Write-Host "Start Mode       : $($svc.StartMode)"
            Write-Host "Process ID       : $($svc.ProcessId)"
            Write-Host "Started At       : $startTime"
            Write-Host "Executable Path  : $($svc.PathName)"
        } else {
            Write-Host "$($svc.Name) : $status, Started: $startTime"
        }
    }
}

function Show-Dashboard {
    while ($true) {
        Write-Host "`n--- Service Dashboard ---"
        foreach ($key in $services.Keys) {
            Write-Host "$key. $($services[$key])"
        }
        Write-Host "0. Exit"

        $choice = Read-Host "Enter number for more info"
        if ($choice -eq '0') { break }
        if ($services.ContainsKey([int]$choice)) {
            $serviceName = $services[[int]$choice]
            Write-Host "`nDetails for $serviceName`n"
            Get-ServiceInfo $serviceName $true
        } else {
            Write-Host "Invalid choice, try again."
        }
    }
}

# Main loop
Write-Host "`nChecking services status..."
foreach ($svc in $services.Values) {
    Get-ServiceInfo $svc
}

# Launch dashboard
Show-Dashboard
