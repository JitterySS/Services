# List of services to check
$services = @(
    "SysMain",
    "CDPUserSvc_*",
    "PcaSvc",
    "DPS",
    "EventLog",
    "Schedule",
    "WSearch",      # SearchIndexer
    "BAM",          # BAM/DAM
    "DUSMsvc",
    "Appinfo"
)

function Get-ServiceInfo {
    param ($serviceName)
    
    # Support wildcard for services like CDPUserSvc_*
    $serviceObjects = Get-CimInstance Win32_Service -Filter "Name LIKE '$serviceName'" -ErrorAction SilentlyContinue
    if (!$serviceObjects) { return @() } # return empty array if not found

    $results = @()
    foreach ($svc in $serviceObjects) {
        $status = $svc.State
        if ($status -eq "Running") {
            try {
                $proc = Get-Process -Id $svc.ProcessId -ErrorAction SilentlyContinue
                $startTime = if ($proc) { $proc.StartTime } else { "Unknown" }
            } catch {
                $startTime = "Unknown"
            }
        } else {
            $startTime = "Not running"
        }

        $results += [PSCustomObject]@{
            Name        = $svc.Name
            DisplayName = $svc.DisplayName
            Status      = $status
            StartMode   = $svc.StartMode
            ProcessId   = $svc.ProcessId
            StartedAt   = $startTime
            Path        = $svc.PathName
        }
    }
    return $results
}

function Show-Dashboard {
    Write-Host "`n--- Service Dashboard ---`n"

    foreach ($svcName in $services) {
        $svcInfos = Get-ServiceInfo $svcName
        if (!$svcInfos) {
            Write-Host "$svcName : Not Found"
            continue
        }
        foreach ($svc in $svcInfos) {
            # Compact single line per service
            Write-Host ("{0,-20} | Status: {1,-10} | StartMode: {2,-8} | PID: {3,-6} | Started: {4}" -f `
                $svc.Name, $svc.Status, $svc.StartMode, $svc.ProcessId, $svc.StartedAt)
        }
    }

    Write-Host "`nPress Enter to close..."
    Read-Host
}

# Run dashboard
Show-Dashboard
